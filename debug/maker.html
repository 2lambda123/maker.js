<html>
<head>
    <title>Maker.js debug TypeScript source code</title>

    <style type="text/css">
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }
        .panel {
            padding: 20px;
        }
        input[type=range] {
            margin-right: 10px;
            width: 100px;
        }
        #view {
            border: 1px dashed silver;
            position: absolute;
            top: 100px;
            bottom: 60px;
            left: 20px;
            right: 20px;
            overflow: hidden;
        }
        svg, #svg-zone {
            position: absolute;
            top: 0;
            height: 100%;
            width: 100%;
        }
        .bottompanel {
            position: absolute;
            left: 20px;
            bottom: 20px;
            right: 20px;
        }
        .bottompanel a {
            background-color: lightsteelblue;
            color: white;
            padding: 4px 10px;
            text-decoration: none;
        }
        label {
            margin-left: 20px;
        }
        .logo {
            position: absolute;
            right: 0px;
            bottom: 0px;
            font-size: 28px;
            font-weight: bold;
            color: silver;
            line-height: 18px;
        }
    </style>

    <script src="../src/maker.js"></script>
    <script src="../src/maker.angle.js"></script>
    <script src="../src/maker.point.js"></script>
    <script src="../src/maker.units.js"></script>
    <script src="../src/maker.measure.js"></script>
    <script src="../src/maker.path.js"></script>
    <script src="../src/maker.model.js"></script>
    <script src="../src/maker.tools.gap.js"></script>
    <script src="../src/maker.exports.xml.js"></script>
    <script src="../src/maker.exports.dxf.js"></script>
    <script src="../src/maker.exports.svg.js"></script>
    <script src="../src/models/RoundRectangle.js"></script>

    <script>

        var svgOrigin = [150, 350];

        var myViewParams = {
            count: 1,
            height: 3,
            width: 4,
            radius: .25,
            angle: 0
        };

        var myModel;
        var viewScale = 90;

        function myModelFactory(params) {

            this.paths = [];
            this.models = [];

            var circle = Maker.Path.CreateCircle('c1', [], Math.min(params.height, params.width) / 2 - .5);

            this.paths.push(Maker.Path.MoveRelative(circle, [params.width / 2, params.height / 2]));

            this.models.push(new Maker.Models.RoundRectangle(params.width, params.height, params.radius));

            Maker.Model.Rotate(this, params.angle);
        }

        function render(newParams) {

            //apply slider parameters
            Maker.ExtendObject(myViewParams, newParams);

            //modeling
            myModel = {
                models: [new myModelFactory(myViewParams)]
            };

            var m = Maker.Measure.ModelExtents(myModel.models[0]);
            var x = m.high.x - m.low.x + .025;

            for (var i = 1; i < myViewParams.count; i++) {
                myModel.models.push(Maker.Model.Move(new myModelFactory(myViewParams), [x * i, 0]));
            }

            //svg output 
            var annotate = document.getElementById('checkAnnotate').checked;
            var svg = Maker.Exports.SVG(myModel, { origin: svgOrigin, scale: viewScale, annotate: annotate });
            document.getElementById("svg-zone").innerHTML = svg;
        }

        function getDxf() {
            var dxf = Maker.Exports.DXF(myModel);
            return "data:application/dxf," + encodeURIComponent(dxf);
        }

        function getSvg() {
            var myOutputScale = 100;
            var svg = Maker.Exports.SVG(myModel, { scale: myOutputScale });
            return "data:image/svg+xml," + encodeURIComponent(svg);
        }


        function prepareView() {

            //attach mousewheel
            var view = document.getElementById("view");
            view.onwheel = view.onmousewheel = function (ev) {
                var scaleDelta = 10;
                viewScale = Math.max(viewScale + ((ev.wheelDelta || ev.deltaY) > 0 ? 1 : -1) * scaleDelta, 1);
                render();
            };

            //show crosshairs
            var size = 50;
            var crossHairs = [Maker.Path.CreateLine('v', [0, size], [0, -size]), Maker.Path.CreateLine('h', [-size, 0], [size, 0]), ];
            view.innerHTML += Maker.Exports.SVG(crossHairs, { origin: svgOrigin, stroke: 'red', strokeWidth: 1 });

            //render model
            render();
        };

        window.onload = prepareView;

    </script>

</head>
<body>

    <div class="panel">
        count: <input type="range" min="1" max="10" step="1" value="1" onchange="render({ count: this.valueAsNumber })" />
        height: <input type="range" min="1" max="7" step=".1" value="3" onchange="render({ height: this.valueAsNumber })" />
        width: <input type="range" min="1" max="7" step=".1" value="4" onchange="render({ width: this.valueAsNumber })" />
        radius: <input type="range" min="0" max="2" step=".1" value=".25" onchange="render({ radius: this.valueAsNumber })" />
        angle: <input type="range" min="-90" max="90" step="2.5" value="0" onchange="render({ angle: - this.valueAsNumber })" />
    </div>

    <div id="view">
        <div id="svg-zone"></div>
    </div>

    <div class="bottompanel">
        <a id="download_dxf" href="#" onclick="this.href = getDxf();" title="Download works in Chrome and Firefox" download="myModel.dxf">download dxf</a>
        <a id="download_svg" href="#" onclick="this.href = getSvg();" title="Download works in Chrome and Firefox" download="myModel.svg">download svg</a>
        <label for="checkAnnotate"> annotate:</label> <input id="checkAnnotate" type="checkbox" onclick="render()" />
        <div class="logo">Maker.js</div>
    </div>

</body>

</html>
